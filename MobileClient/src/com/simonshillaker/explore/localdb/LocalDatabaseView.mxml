<?xml version="1.0" encoding="utf-8"?>
<core:BackButtonView xmlns:core="com.simonshillaker.explore.core.*"
					 xmlns:fx="http://ns.adobe.com/mxml/2009"
					 xmlns:s="library://ns.adobe.com/flex/spark"
					 title="{resourceManager.getString('explore_air_mobile', 'local_db_title')}"
					 remove="onRemove()">
	
	<fx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			import mx.rpc.events.FaultEvent;
			
			private static const LEFT_COL_WIDTH:int = 80;
			
			[Bindable]
			private var db:UserDao = new UserDao();
			
			private function handleAddUser(event:MouseEvent):void
			{
				var newUser:User = new User();
				
				newUser.name = nameInput.text;
				newUser.username = userNameInput.text;
				
				db.createUser(newUser);
				
				clearTextFields();
			}
			
			private function clearTextFields():void
			{
				nameInput.text = "";
				userNameInput.text = "";
			}
			
			private function handleClearAllUsers():void
			{
				db.deleteAllUsers();
			}
			
			private function onRemove():void
			{
				db.dispose();
			}
			
		]]>
	</fx:Script>
	
	<s:BusyIndicator visible="{!db.initialised}" horizontalCenter="0"
					 includeInLayout="{!db.initialised}" verticalCenter="0"/>

	<s:Scroller width="100%" height="100%">

		<s:VGroup id="mainViewGroup" 
				  visible="{db.initialised}" 
				  width="100%" height="100%"
				  horizontalAlign="center" 
				  paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="5">
		
			<s:Label id="errorLabel" 
					 width="100%" 
					 visible="{db.errorText.length > 0}" 
					 includeInLayout="{db.errorText.length > 0}"
					 text = "{db.errorText}"
					 styleName="error"/>
		
			<s:HGroup width="100%" verticalAlign="middle">
				
				<s:Label width="{LEFT_COL_WIDTH}" 
						 text="{resourceManager.getString('explore_air_mobile', 'local_db_username_label')}"/>
				
				<s:TextInput id="userNameInput" 
							 width="100%"/>
			
			</s:HGroup>
			
			<s:HGroup width="100%" verticalAlign="middle">
				
				<s:Label width="{LEFT_COL_WIDTH}"		
						 text="{resourceManager.getString('explore_air_mobile', 'local_db_name_label')}"/>
				
				<s:TextInput id="nameInput" width="100%"/>
			
			</s:HGroup>
			
			<s:Button width="100%" 
					  label="{resourceManager.getString('explore_air_mobile', 'local_db_add_user_label')}"
					  click="handleAddUser(event)"/>
			
			<s:List width="100%" height="100%" minHeight="80" 
					dataProvider="{db.users}"
					itemRenderer="com.simonshillaker.explore.localdb.UserItemRenderer"/>
			
			<s:Button width="100%" 
					  label="{resourceManager.getString('explore_air_mobile', 'local_db_clear_data_label')}"
					  click="handleClearAllUsers()"/> 
			
		</s:VGroup>
	</s:Scroller>
	
</core:BackButtonView>
